{"version":3,"file":"plugin.min.js","sources":["../src/plugin.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny formatting for Moodle\n *\n * @module      tiny_formatting/plugin\n * @copyright   2024, ISB Bayern\n * @author      Dr. Peter Mayer\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {component, pluginName} from 'tiny_formatting/common';\nimport {getTinyMCE} from 'editor_tiny/loader';\nimport {getPluginMetadata} from 'editor_tiny/utils';\nimport {getPluginOptionName} from 'editor_tiny/options';\n\nconst availableFontsName = getPluginOptionName(pluginName, 'fonts');\n\nexport const getAvailableFonts = (editor) => editor.options.get(availableFontsName);\n\n// Setup the tiny_formatting Plugin.\nconst configureMenu = (menu) => {\n    if (menu.format.items.match(/\\bblocks\\b/)) {\n        menu.format.items = menu.format.items.replace(\n            /(\\bblocks\\b)/,\n            ' styles $1 fontfamily fontsize',\n        );\n    } else {\n        menu.format.items = `${menu.format.items} | fontfamily fontsize`;\n    }\n\n    if (menu.format.items.match(/\\blanguage\\b/)) {\n        menu.format.items = menu.format.items.replace(\n            /(\\blanguage\\b)/,\n            ' forecolor backcolor | $1',\n        );\n    } else {\n        menu.format.items = `${menu.format.items} | forecolor backcolor`;\n    }\n    return menu;\n};\n\n// eslint-disable-next-line no-async-promise-executor\nexport default new Promise(async (resolve) => {\n    // Note: The PluginManager.add function does not support asynchronous configuration.\n    // Perform any asynchronous configuration here, and then call the PluginManager.add function.\n    const [\n        tinyMCE,\n        pluginMetadata,\n    ] = await Promise.all([\n        getTinyMCE(),\n        getPluginMetadata(component, pluginName),\n    ]);\n\n    // Reminder: Any asynchronous code must be run before this point.\n    tinyMCE.PluginManager.add(pluginName, () => {\n        return pluginMetadata;\n    });\n\n    resolve([pluginName, {\n        configure: (instanceConfig, options) => {\n            let styleelements = document.querySelectorAll('head link[href*=\"styles.php\"]');\n            styleelements.forEach(el => {\n                instanceConfig.content_css.push(el.href);\n            });\n\n            return {\n                menu: configureMenu(instanceConfig.menu),\n                font_family_formats: options.plugins['tiny_formatting/plugin'].config.fonts,\n            };\n        }\n    }]);\n});\n"],"names":["availableFontsName","pluginName","editor","options","get","Promise","async","tinyMCE","pluginMetadata","all","component","PluginManager","add","resolve","configure","instanceConfig","document","querySelectorAll","forEach","el","content_css","push","href","menu","format","items","match","replace","font_family_formats","plugins","config","fonts"],"mappings":";;;;;;;;;MA6BMA,oBAAqB,gCAAoBC,mBAAY,oCAEzBC,QAAWA,OAAOC,QAAQC,IAAIJ,iCAyBjD,IAAIK,SAAQC,MAAAA,gBAInBC,QACAC,sBACMH,QAAQI,IAAI,EAClB,yBACA,4BAAkBC,kBAAWT,sBAIjCM,QAAQI,cAAcC,IAAIX,oBAAY,IAC3BO,iBAGXK,QAAQ,CAACZ,mBAAY,CACjBa,UAAW,CAACC,eAAgBZ,kBACJa,SAASC,iBAAiB,iCAChCC,SAAQC,KAClBJ,eAAeK,YAAYC,KAAKF,GAAGG,SAGhC,CACHC,MA9COA,KA8CaR,eAAeQ,KA7C3CA,KAAKC,OAAOC,MAAMC,MAAM,cACxBH,KAAKC,OAAOC,MAAQF,KAAKC,OAAOC,MAAME,QAClC,eACA,kCAGJJ,KAAKC,OAAOC,gBAAWF,KAAKC,OAAOC,gCAGnCF,KAAKC,OAAOC,MAAMC,MAAM,gBACxBH,KAAKC,OAAOC,MAAQF,KAAKC,OAAOC,MAAME,QAClC,iBACA,6BAGJJ,KAAKC,OAAOC,gBAAWF,KAAKC,OAAOC,gCAEhCF,MA6BKK,oBAAqBzB,QAAQ0B,QAAQ,0BAA0BC,OAAOC,OA/C/DR,IAAAA"}